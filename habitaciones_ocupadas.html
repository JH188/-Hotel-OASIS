<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hotel OASIS - Habitaciones Ocupadas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      background: #f8f9fa;
      font-family: "Segoe UI", Arial, sans-serif;
    }
    .ocupada-card {
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
      transition: transform 0.25s ease, box-shadow 0.25s;
      overflow: hidden;
      background: #fff;
    }
    .ocupada-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    .ocupada-card img {
      height: 200px;
      object-fit: cover;
      width: 100%;
    }
    .ocupada-card h5 { font-weight: bold; }
    .ocupada-card p { margin: 4px 0; font-size: 0.95rem; }
    .no-ocupadas {
      text-align: center;
      color: #6c757d;
      font-size: 1.2rem;
      padding: 50px 0;
    }
    footer {
      background: #212529;
      color: #bbb;
      padding: 18px;
      text-align: center;
      margin-top: 40px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <!-- BotÃ³n volver -->
    <a href="index.html" class="btn btn-secondary mb-4">
      <i class="fa fa-arrow-left me-2"></i> Volver al Dashboard
    </a>

    <h2 class="fw-bold mb-4 text-danger text-center">
      <i class="fa fa-door-closed me-2"></i> Habitaciones Ocupadas
    </h2>

    <div id="ocupadasContainer" class="row g-4"></div>
  </div>

  <footer>&copy; 2025 Hotel OASIS - Todos los derechos reservados</footer>

  <script src="js.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Renderizar las habitaciones ocupadas
    function cargarOcupadas() {
      const data = getHotelData();
      const container = document.getElementById("ocupadasContainer");
      container.innerHTML = "";

      const reservasVigentes = data.reservas.filter(r => r.estado === "Activa");

      if (reservasVigentes.length === 0) {
        container.innerHTML = `
          <div class="no-ocupadas text-center p-4">
            <i class="fa fa-bed fa-2x mb-3 text-secondary"></i>
            <p class="text-muted">No hay habitaciones ocupadas actualmente.</p>
          </div>`;
        return;
      }

      reservasVigentes.forEach(reserva => {
        const card = document.createElement("div");
        card.classList.add("col-md-4");
        card.innerHTML = `
          <div class="ocupada-card card h-100 shadow-sm">
            <img src="img/${reserva.imagen}" alt="${reserva.habitacion}" class="card-img-top">
            <div class="p-3">
              <h5 class="text-dark"><i class="fa fa-bed me-2 text-danger"></i>${reserva.habitacion}</h5>
              <p><i class="fa fa-user me-2 text-primary"></i><strong>HuÃ©sped:</strong> ${reserva.nombre}</p>
              <p><i class="fa fa-sign-in-alt me-2 text-success"></i><strong>Ingreso:</strong> ${reserva.ingreso}</p>
              <p><i class="fa fa-sign-out-alt me-2 text-warning"></i><strong>Salida:</strong> ${reserva.salida}</p>
              <p><i class="fa fa-wallet me-2 text-info"></i><strong>MÃ©todo de Pago:</strong> ${reserva.metodoPago || "No registrado"}</p>
              <p><i class="fa fa-dollar-sign me-2 text-success"></i><strong>Total Pagado:</strong> $${reserva.total || "0.00"}</p>
              <p><i class="fa fa-check-circle me-2 text-success"></i><strong>Estado del Pago:</strong> Confirmado</p>
              
              <button class="btn btn-danger w-100 mt-2" 
                onclick="finalizarReserva(${reserva.id}); cargarOcupadas();">
                <i class="fa fa-times-circle me-2"></i> Finalizar Estancia
              </button>
            </div>
          </div>`;
        container.appendChild(card);
      });
    }

    // ðŸ”’ Seguridad: verificar sesiÃ³n, bloqueo y expulsiÃ³n
    document.addEventListener("DOMContentLoaded", () => {
      const usuarioActivo = JSON.parse(localStorage.getItem("usuarioActivo"));
      const bloqueados = JSON.parse(localStorage.getItem("usuariosBloqueados")) || [];
      const expulsado = localStorage.getItem("usuarioExpulsado");

      if (!usuarioActivo) {
        window.location.href = "login.html";
      } else if (bloqueados.includes(usuarioActivo.email)) {
        localStorage.removeItem("usuarioActivo");
        alert("â›” Tu cuenta fue bloqueada por el administrador.");
        window.location.href = "login.html";
      } else if (expulsado && expulsado === usuarioActivo.email) {
        localStorage.removeItem("usuarioActivo");
        localStorage.removeItem("usuarioExpulsado");
        alert("ðŸšª Has sido expulsado de tu sesiÃ³n por el administrador.");
        window.location.href = "login.html";
      }

      cargarOcupadas();
    });

    // ðŸ”„ Refrescar automÃ¡ticamente si cambian reservas en otra pestaÃ±a
    window.addEventListener("storage", () => {
      cargarOcupadas();
    });

    // ðŸšª Cerrar sesiÃ³n
    function logout() {
      localStorage.removeItem("usuarioActivo");
      window.location.href = "login.html";
    }
  </script>
</body>
</html>
